<div class="page-container">
  <pagetitle
    title="Gerenciar Membros"
    subtitle="Gerenciamento de membros da IPBF"
  ></pagetitle>

  <div class="actions-bar">
    <div class="search-filters">
      <div class="search-box">
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (input)="filterMembers()"
          placeholder="Buscar membros..."
        />
        <div class="search-icon" [innerHTML]="getSearchIcon()" [attr.aria-hidden]="true"></div>
      </div>
      <select [(ngModel)]="tipoCadastroFilter" (change)="filterMembers()" class="filter-select">
        <option value="">Membros por tipo</option>
        <option value="Membro">Membro</option>
        <option value="Visitante">Visitante</option>
        <option value="Seminarista">Seminarista</option>
        <option value="Presbítero">Presbítero</option>
        <option value="Pastor">Pastor</option>
        <!-- Adicione mais opções conforme necessário -->
      </select>
      <!-- <select [(ngModel)]="estadoCivilFilter" (change)="filterMembers()" class="filter-select">
        <option value="">Buscar por Status Civil</option>
        <option [value]="false">Solteiro</option>
        <option [value]="true">Casado</option>
      </select> -->
    </div>
    <button class="btn-secondary" (click)="getMembers()">Atualizar</button>
    <button class="btn-primary" (click)="openMemberModal()">+ Novo Membro</button>
  </div>

  <app-data-table
    [columns]="tableColumns"
    [data]="getTableData()"
    [actions]="getTableActions()"
    [loading]="false"
    emptyMessage="Nenhum membro encontrado"
    [striped]="true"
    [hoverable]="true"
  ></app-data-table>

  <div class="pagination">
    <div class="pagination-left">
      <label for="itemsPerPage" class="pagination-label">Itens por página:</label>
      <select 
        id="itemsPerPage" 
        class="pagination-select" 
        [(ngModel)]="itemsPerPage" 
        (change)="onItemsPerPageChange()"
      >
        @for (option of getItemsPerPageOptions(); track option) {
          <option [value]="option">{{ option }}</option>
        }
      </select>
    </div>
    <div class="pagination-center">
      <button class="btn-pagination" [disabled]="currentPage === 1" (click)="previousPage()">
        ← Anterior
      </button>
      <span class="pagination-info">
        Página {{ currentPage }} de {{ totalPages }}
      </span>
      <button class="btn-pagination" [disabled]="currentPage === totalPages" (click)="nextPage()">
        Próxima →
      </button>
    </div>
  </div>

  <!-- Edit/Create Member Modal -->
  <app-modal
    [title]="isEditing ? 'Editar Membro' : 'Novo Membro'"
    [isOpen]="showMemberModal"
    [size]="'xlarge'"
    [footerButtons]="getEditModalButtons()"
    (close)="closeMemberModal()">
    
    <form (ngSubmit)="saveMember()">
      <div class="form-section">
        <h4 class="section-title">Informações Básicas</h4>
        <div class="form-grid">

          <div class="form-group">
            <label>Nome Completo *</label>
            <input
              type="text"
              [(ngModel)]="currentMember.nome"
              name="nome"
              class="form-control"
              required
            />
          </div>

          <div class="form-group">
            <label>Data de Nascimento</label>
            <input
              type="date"
              [(ngModel)]="currentMember.nascimento"
              name="nascimento"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label>Estado Civil <span class="required">*</span></label>
            <select
              [(ngModel)]="currentMember.estadoCivil"
              name="estadoCivil"
              class="form-control"
              required
            >
              <option [value]="false">Solteiro</option>
              <option [value]="true">Casado</option>
            </select>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h4 class="section-title">Documentos</h4>
        <div class="form-grid">
          <div class="form-group">
            <label>CPF</label>
            <input
              type="text"
              [(ngModel)]="currentMember.cpf"
              name="cpf"
              class="form-control"
              maxlength="14"
              placeholder="000.000.000-00"
            />
          </div>

          <div class="form-group">
            <label>RG</label>
            <input
              type="text"
              [(ngModel)]="currentMember.rg"
              name="rg"
              class="form-control"
              maxlength="20"
              placeholder="00.000.000-0"
            />
          </div>

          @if (currentMember.estadoCivil) {
            <div class="form-group">
              <label>Conjugue CPF</label>
              <input
                type="text"
                [(ngModel)]="currentMember.conjugueCPF"
                name="conjugueCPF"
                class="form-control"
                maxlength="14"
                placeholder="000.000.000-00"
              />
            </div>
          }
        </div>
      </div>

      <div class="form-section">
        <h4 class="section-title">Contatos</h4>
        <div class="form-grid">

          <div class="form-group">
            <label>Telefone</label>
            <input
              type="text"
              [(ngModel)]="currentMember.telefone"
              name="telefone"
              class="form-control"
              placeholder="(11)0000.0000"
            />
          </div>

          <div class="form-group">
            <label>Celular</label>
            <input
              type="text"
              [(ngModel)]="currentMember.celular"
              name="celular"
              class="form-control"
              placeholder="(11)0000.0000"
            />
          </div>

          <div class="form-group">
            <label>Comercial</label>
            <input
              type="text"
              [(ngModel)]="currentMember.comercial"
              name="comercial"
              class="form-control"
              placeholder="(11)0000.0000"
            />
          </div>

          <div class="form-group">
            <label>Email <span class="required">*</span></label>
            <input
              type="email"
              [(ngModel)]="currentMember.email"
              name="email"
              class="form-control"
              required
              placeholder="email@gmail.com"
            />
          </div>

          <div class="form-group">
            <label>Operadora</label>
            <input
              type="text"
              [(ngModel)]="currentMember.operadora"
              name="operadora"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label>Contato</label>
            <input
              type="text"
              [(ngModel)]="currentMember.contato"
              name="contato"
              class="form-control"
            />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h4 class="section-title">Endereço</h4>
        <div class="form-grid">
          <div class="form-group">
            <label>CEP</label>
            <input
              type="text"
              [(ngModel)]="currentMember.cep"
              name="cep"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label>Logradouro</label>
            <input
              type="text"
              [(ngModel)]="currentMember.logradouro"
              name="logradouro"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label>Número</label>
            <input
              type="text"
              [(ngModel)]="currentMember.numero"
              name="numero"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label>Complemento</label>
            <input
              type="text"
              [(ngModel)]="currentMember.complemento"
              name="complemento"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label>Bairro</label>
            <input
              type="text"
              [(ngModel)]="currentMember.bairro"
              name="bairro"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label>Cidade</label>
            <input
              type="text"
              [(ngModel)]="currentMember.cidade"
              name="cidade"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label>Estado</label>
            <input
              type="text"
              [(ngModel)]="currentMember.estado"
              name="estado"
              class="form-control"
            />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h4 class="section-title">Configurações</h4>
        <div class="form-grid">
          <div class="form-group">
            <label>Comungante</label>
            <select
              [(ngModel)]="currentMember.comungante"
              name="comungante"
              class="form-control"
            >
              <option [value]="true">Sim</option>
              <option [value]="false">Não</option>
            </select>
          </div>

          <div class="form-group">
            <label>Intercessor</label>
            <select
              [(ngModel)]="currentMember.intercessor"
              name="intercessor"
              class="form-control"
            >
              <option [value]="true">Sim</option>
              <option [value]="false">Não</option>
            </select>
          </div>

          <div class="form-group">
            <label>Tipo de Cadastro</label>
            <select
              [(ngModel)]="currentMember.tipoCadastro"
              name="tipoCadastro"
              class="form-control"
            >
              <option [value]="'Membro'">Membro</option>
              <option [value]="'Visitante'">Visitante</option>
              <option [value]="'Seminarista'">Seminarista</option>
              <option [value]="'Presbítero'">Presbítero</option>
              <option [value]="'Pastor'">Pastor</option>
            </select>
          </div>

          <div class="form-group">
            <label>LGPD Aceito?</label>
            <select
              [(ngModel)]="currentMember.lgpd"
              name="lgpd"
              class="form-control"
            >
              <option [value]="true">Sim</option>
              <option [value]="false">Não</option>
            </select>
          </div>

          <div class="form-group">
            <label>LGPD Aceito Quando?</label>
            <input
              type="date"
              [(ngModel)]="currentMember.lgpdAceitoEm"
              name="lgpdAceitoEm"
              class="form-control"
            />
          </div>
        </div>
      </div>
    </form>
  </app-modal>

  <!-- View Member Modal -->
  <app-modal
    [title]="'Detalhes do Membro'"
    [isOpen]="showViewModal"
    [size]="'large'"
    [footerButtons]="getViewModalButtons()"
    (close)="closeViewModal()">
    
    @if (viewingMember) {
      <div class="detail-section">
        <h4 class="section-title">Informações Básicas</h4>
        <div class="details-grid">
          <div class="detail-item">
            <label>Nome Completo</label>
            <span>{{ viewingMember.nome || 'Não informado' }}</span>
          </div>
          <div class="detail-item">
            <label>Data de Nascimento</label>
            <span>{{ viewingMember.nascimento ? (viewingMember.nascimento | date:'dd/MM/yyyy') : 'Não informado' }}</span>
          </div>
          <div class="detail-item">
            <label>Estado Civil</label>
            <span class="badge" [class.active]="viewingMember.estadoCivil">
              {{ viewingMember.estadoCivil ? 'Casado' : 'Solteiro' }}
            </span>
          </div>
          <div class="detail-item">
            <label>Tipo de Cadastro</label>
            <span>{{ viewingMember.tipoCadastro || 'Não informado' }}</span>
          </div>
        </div>
      </div>

      <div class="detail-section">
        <h4 class="section-title">Documentos</h4>
        <div class="details-grid">
          <div class="detail-item">
            <label>CPF</label>
            <span>{{ viewingMember.cpf || 'Não informado' }}</span>
          </div>
          <div class="detail-item">
            <label>RG</label>
            <span>{{ viewingMember.rg || 'Não informado' }}</span>
          </div>
          @if (viewingMember.conjugueCPF) {
            <div class="detail-item">
              <label>CPF do Cônjuge</label>
              <span>{{ viewingMember.conjugueCPF }}</span>
            </div>
          }
        </div>
      </div>

      <div class="detail-section">
        <h4 class="section-title">Contatos</h4>
        <div class="details-grid">
          <div class="detail-item">
            <label>Email</label>
            <span>{{ viewingMember.email || 'Não informado' }}</span>
          </div>
          <div class="detail-item">
            <label>Telefone</label>
            <span>{{ viewingMember.telefone || 'Não informado' }}</span>
          </div>
          <div class="detail-item">
            <label>Celular</label>
            <span>{{ viewingMember.celular || 'Não informado' }}</span>
          </div>
          <div class="detail-item">
            <label>Comercial</label>
            <span>{{ viewingMember.comercial || 'Não informado' }}</span>
          </div>
          @if (viewingMember.operadora) {
            <div class="detail-item">
              <label>Operadora</label>
              <span>{{ viewingMember.operadora }}</span>
            </div>
          }
        </div>
      </div>

      <div class="detail-section">
        <h4 class="section-title">Endereço</h4>
        <div class="details-grid">
          <div class="detail-item">
            <label>CEP</label>
            <span>{{ viewingMember.cep || 'Não informado' }}</span>
          </div>
          <div class="detail-item">
            <label>Logradouro</label>
            <span>{{ viewingMember.logradouro || 'Não informado' }}</span>
          </div>
          <div class="detail-item">
            <label>Número</label>
            <span>{{ viewingMember.numero || 'Não informado' }}</span>
          </div>
          @if (viewingMember.complemento) {
            <div class="detail-item">
              <label>Complemento</label>
              <span>{{ viewingMember.complemento }}</span>
            </div>
          }
          <div class="detail-item">
            <label>Bairro</label>
            <span>{{ viewingMember.bairro || 'Não informado' }}</span>
          </div>
          <div class="detail-item">
            <label>Cidade</label>
            <span>{{ viewingMember.cidade || 'Não informado' }}</span>
          </div>
          <div class="detail-item">
            <label>Estado</label>
            <span>{{ viewingMember.estado || 'Não informado' }}</span>
          </div>
        </div>
      </div>

      <div class="detail-section">
        <h4 class="section-title">Configurações</h4>
        <div class="details-grid">
          <div class="detail-item">
            <label>Comungante</label>
            <span class="badge" [class.active]="viewingMember.comungante" [class.inactive]="!viewingMember.comungante">
              {{ viewingMember.comungante ? 'Sim' : 'Não' }}
            </span>
          </div>
          <div class="detail-item">
            <label>Intercessor</label>
            <span class="badge" [class.active]="viewingMember.intercessor" [class.inactive]="!viewingMember.intercessor">
              {{ viewingMember.intercessor ? 'Sim' : 'Não' }}
            </span>
          </div>
          <div class="detail-item">
            <label>LGPD Aceito</label>
            <span class="badge" [class.active]="viewingMember.lgpd" [class.inactive]="!viewingMember.lgpd">
              {{ viewingMember.lgpd ? 'Sim' : 'Não' }}
            </span>
          </div>
          @if (viewingMember.lgpdAceitoEm) {
            <div class="detail-item">
              <label>LGPD Aceito Em</label>
              <span>{{ viewingMember.lgpdAceitoEm | date:'dd/MM/yyyy' }}</span>
            </div>
          }
        </div>
      </div>
    }
  </app-modal>
</div>
