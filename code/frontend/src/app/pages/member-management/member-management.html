<div class="page-container">
  <pagetitle
    title="Gerenciar Membros"
    subtitle="Gerenciamento de membros da IPBF"
  ></pagetitle>

  <div class="actions-bar">
    <div class="search-filters">
      <div class="search-box">
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (input)="filterMembers()"
          placeholder="Buscar membros..."
        />
        <div class="search-icon">üîç</div>
      </div>
      <select [(ngModel)]="tipoCadastroFilter" (change)="filterMembers()" class="filter-select">
        <option value="">Membros por tipo</option>
        <option value="Membro">Membro</option>
        <option value="Visitante">Visitante</option>
        <option value="Seminarista">Seminarista</option>
        <option value="Presb√≠tero">Presb√≠tero</option>
        <option value="Pastor">Pastor</option>
        <!-- Adicione mais op√ß√µes conforme necess√°rio -->
      </select>
      <!-- <select [(ngModel)]="estadoCivilFilter" (change)="filterMembers()" class="filter-select">
        <option value="">Buscar por Status Civil</option>
        <option [value]="false">Solteiro</option>
        <option [value]="true">Casado</option>
      </select> -->
    </div>
    <button class="btn-secondary" (click)="getMembers()">Atualizar</button>
    <button class="btn-primary" (click)="openMemberModal()">+ Novo Membro</button>
  </div>

  <div class="members-table-container">
    <table class="members-table">
      <thead>
        <tr>
          <th>Nome</th>
          <th>CPF</th>
          <th>RG</th>
          <th>Data de Nascimento</th>
          <th>Estado Civil</th>
          <th>Telefone</th>
          <th>Email</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let member of filteredMembers" class="member-row">
          <td>{{ member.nome }}</td>
          <td>{{ member.cpf }}</td>
          <td>{{ member.rg }}</td>
          <td>{{ member.nascimento | date:'dd/MM/yyyy' }}</td>
          <td>{{ member.estadoCivil ? 'Casado' : 'Solteiro' }}</td>
          <td>{{ member.telefone || member.celular || member.comercial || '-' }}</td>
          <td>{{ member.email }}</td>
          <td>
            <div class="action-buttons">
              <button class="btn-action view" (click)="viewMember(member)" title="Visualizar">üëÅÔ∏è</button>
              <button class="btn-action edit" (click)="editMember(member)" title="Editar">‚úèÔ∏è</button>
              <button class="btn-action delete" (click)="deleteMember(member)" title="Excluir">üóëÔ∏è</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="empty-state" *ngIf="filteredMembers.length === 0">
      <div class="empty-icon">üë§</div>
      <h3>Nenhum membro encontrado</h3>
      <p>Tente ajustar os filtros ou criar um novo membro</p>
    </div>
  </div>

  <div class="pagination">
    <button class="btn-pagination" [disabled]="currentPage === 1" (click)="previousPage()">
      ‚Üê Anterior
    </button>
    <span class="pagination-info">
      P√°gina {{ currentPage }} de {{ totalPages }}
    </span>
    <button class="btn-pagination" [disabled]="currentPage === totalPages" (click)="nextPage()">
      Pr√≥xima ‚Üí
    </button>
  </div>

  <!-- Edit/Create Member Modal -->
  <app-modal
    [title]="isEditing ? 'Editar Membro' : 'Novo Membro'"
    [isOpen]="showMemberModal"
    [size]="'xlarge'"
    [footerButtons]="getEditModalButtons()"
    (close)="closeMemberModal()">
    
    <form (ngSubmit)="saveMember()">
      <div class="form-section">
        <h4 class="section-title">Informa√ß√µes B√°sicas</h4>
        <div class="form-grid">

          <div class="form-group">
            <label>Nome Completo *</label>
            <input
              type="text"
              [(ngModel)]="currentMember.nome"
              name="nome"
              class="form-control"
              required
            />
          </div>

          <div class="form-group">
            <label>Data de Nascimento</label>
            <input
              type="date"
              [(ngModel)]="currentMember.nascimento"
              name="nascimento"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label>Estado Civil <span class="required">*</span></label>
            <select
              [(ngModel)]="currentMember.estadoCivil"
              name="estadoCivil"
              class="form-control"
              required
            >
              <option [value]="false">Solteiro</option>
              <option [value]="true">Casado</option>
            </select>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h4 class="section-title">Documentos</h4>
        <div class="form-grid">
          <div class="form-group">
            <label>CPF</label>
            <input
              type="text"
              [(ngModel)]="currentMember.cpf"
              name="cpf"
              class="form-control"
              maxlength="14"
              placeholder="000.000.000-00"
            />
          </div>

          <div class="form-group">
            <label>RG</label>
            <input
              type="text"
              [(ngModel)]="currentMember.rg"
              name="rg"
              class="form-control"
              maxlength="20"
              placeholder="00.000.000-0"
            />
          </div>

          @if (currentMember.estadoCivil) {
            <div class="form-group">
              <label>Conjugue CPF</label>
              <input
                type="text"
                [(ngModel)]="currentMember.conjugueCPF"
                name="conjugueCPF"
                class="form-control"
                maxlength="14"
                placeholder="000.000.000-00"
              />
            </div>
          }
        </div>
      </div>

      <div class="form-section">
        <h4 class="section-title">Contatos</h4>
        <div class="form-grid">

          <div class="form-group">
            <label>Telefone</label>
            <input
              type="text"
              [(ngModel)]="currentMember.telefone"
              name="telefone"
              class="form-control"
              placeholder="(11)0000.0000"
            />
          </div>

          <div class="form-group">
            <label>Celular</label>
            <input
              type="text"
              [(ngModel)]="currentMember.celular"
              name="celular"
              class="form-control"
              placeholder="(11)0000.0000"
            />
          </div>

          <div class="form-group">
            <label>Comercial</label>
            <input
              type="text"
              [(ngModel)]="currentMember.comercial"
              name="comercial"
              class="form-control"
              placeholder="(11)0000.0000"
            />
          </div>

          <div class="form-group">
            <label>Email <span class="required">*</span></label>
            <input
              type="email"
              [(ngModel)]="currentMember.email"
              name="email"
              class="form-control"
              required
              placeholder="email@gmail.com"
            />
          </div>

          <div class="form-group">
            <label>Operadora</label>
            <input
              type="text"
              [(ngModel)]="currentMember.operadora"
              name="operadora"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label>Contato</label>
            <input
              type="text"
              [(ngModel)]="currentMember.contato"
              name="contato"
              class="form-control"
            />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h4 class="section-title">Endere√ßo</h4>
        <div class="form-grid">
          <div class="form-group">
            <label>CEP</label>
            <input
              type="text"
              [(ngModel)]="currentMember.cep"
              name="cep"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label>Logradouro</label>
            <input
              type="text"
              [(ngModel)]="currentMember.logradouro"
              name="logradouro"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label>N√∫mero</label>
            <input
              type="text"
              [(ngModel)]="currentMember.numero"
              name="numero"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label>Complemento</label>
            <input
              type="text"
              [(ngModel)]="currentMember.complemento"
              name="complemento"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label>Bairro</label>
            <input
              type="text"
              [(ngModel)]="currentMember.bairro"
              name="bairro"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label>Cidade</label>
            <input
              type="text"
              [(ngModel)]="currentMember.cidade"
              name="cidade"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label>Estado</label>
            <input
              type="text"
              [(ngModel)]="currentMember.estado"
              name="estado"
              class="form-control"
            />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h4 class="section-title">Configura√ß√µes</h4>
        <div class="form-grid">
          <div class="form-group">
            <label>Comungante</label>
            <select
              [(ngModel)]="currentMember.comungante"
              name="comungante"
              class="form-control"
            >
              <option [value]="true">Sim</option>
              <option [value]="false">N√£o</option>
            </select>
          </div>

          <div class="form-group">
            <label>Intercessor</label>
            <select
              [(ngModel)]="currentMember.intercessor"
              name="intercessor"
              class="form-control"
            >
              <option [value]="true">Sim</option>
              <option [value]="false">N√£o</option>
            </select>
          </div>

          <div class="form-group">
            <label>Tipo de Cadastro</label>
            <select
              [(ngModel)]="currentMember.tipoCadastro"
              name="tipoCadastro"
              class="form-control"
            >
              <option [value]="'Membro'">Membro</option>
              <option [value]="'Visitante'">Visitante</option>
              <option [value]="'Seminarista'">Seminarista</option>
              <option [value]="'Presb√≠tero'">Presb√≠tero</option>
              <option [value]="'Pastor'">Pastor</option>
            </select>
          </div>

          <div class="form-group">
            <label>LGPD Aceito?</label>
            <select
              [(ngModel)]="currentMember.lgpd"
              name="lgpd"
              class="form-control"
            >
              <option [value]="true">Sim</option>
              <option [value]="false">N√£o</option>
            </select>
          </div>

          <div class="form-group">
            <label>LGPD Aceito Quando?</label>
            <input
              type="date"
              [(ngModel)]="currentMember.lgpdAceitoEm"
              name="lgpdAceitoEm"
              class="form-control"
            />
          </div>
        </div>
      </div>
    </form>
  </app-modal>

  <!-- View Member Modal -->
  <app-modal
    [title]="'Detalhes do Membro'"
    [isOpen]="showViewModal"
    [size]="'large'"
    [footerButtons]="getViewModalButtons()"
    (close)="closeViewModal()">
    
    @if (viewingMember) {
      <div class="detail-section">
        <h4 class="section-title">Informa√ß√µes B√°sicas</h4>
        <div class="details-grid">
          <div class="detail-item">
            <label>Nome Completo</label>
            <span>{{ viewingMember.nome || 'N√£o informado' }}</span>
          </div>
          <div class="detail-item">
            <label>Data de Nascimento</label>
            <span>{{ viewingMember.nascimento ? (viewingMember.nascimento | date:'dd/MM/yyyy') : 'N√£o informado' }}</span>
          </div>
          <div class="detail-item">
            <label>Estado Civil</label>
            <span class="badge" [class.active]="viewingMember.estadoCivil">
              {{ viewingMember.estadoCivil ? 'Casado' : 'Solteiro' }}
            </span>
          </div>
          <div class="detail-item">
            <label>Tipo de Cadastro</label>
            <span>{{ viewingMember.tipoCadastro || 'N√£o informado' }}</span>
          </div>
        </div>
      </div>

      <div class="detail-section">
        <h4 class="section-title">Documentos</h4>
        <div class="details-grid">
          <div class="detail-item">
            <label>CPF</label>
            <span>{{ viewingMember.cpf || 'N√£o informado' }}</span>
          </div>
          <div class="detail-item">
            <label>RG</label>
            <span>{{ viewingMember.rg || 'N√£o informado' }}</span>
          </div>
          @if (viewingMember.conjugueCPF) {
            <div class="detail-item">
              <label>CPF do C√¥njuge</label>
              <span>{{ viewingMember.conjugueCPF }}</span>
            </div>
          }
        </div>
      </div>

      <div class="detail-section">
        <h4 class="section-title">Contatos</h4>
        <div class="details-grid">
          <div class="detail-item">
            <label>Email</label>
            <span>{{ viewingMember.email || 'N√£o informado' }}</span>
          </div>
          <div class="detail-item">
            <label>Telefone</label>
            <span>{{ viewingMember.telefone || 'N√£o informado' }}</span>
          </div>
          <div class="detail-item">
            <label>Celular</label>
            <span>{{ viewingMember.celular || 'N√£o informado' }}</span>
          </div>
          <div class="detail-item">
            <label>Comercial</label>
            <span>{{ viewingMember.comercial || 'N√£o informado' }}</span>
          </div>
          @if (viewingMember.operadora) {
            <div class="detail-item">
              <label>Operadora</label>
              <span>{{ viewingMember.operadora }}</span>
            </div>
          }
        </div>
      </div>

      <div class="detail-section">
        <h4 class="section-title">Endere√ßo</h4>
        <div class="details-grid">
          <div class="detail-item">
            <label>CEP</label>
            <span>{{ viewingMember.cep || 'N√£o informado' }}</span>
          </div>
          <div class="detail-item">
            <label>Logradouro</label>
            <span>{{ viewingMember.logradouro || 'N√£o informado' }}</span>
          </div>
          <div class="detail-item">
            <label>N√∫mero</label>
            <span>{{ viewingMember.numero || 'N√£o informado' }}</span>
          </div>
          @if (viewingMember.complemento) {
            <div class="detail-item">
              <label>Complemento</label>
              <span>{{ viewingMember.complemento }}</span>
            </div>
          }
          <div class="detail-item">
            <label>Bairro</label>
            <span>{{ viewingMember.bairro || 'N√£o informado' }}</span>
          </div>
          <div class="detail-item">
            <label>Cidade</label>
            <span>{{ viewingMember.cidade || 'N√£o informado' }}</span>
          </div>
          <div class="detail-item">
            <label>Estado</label>
            <span>{{ viewingMember.estado || 'N√£o informado' }}</span>
          </div>
        </div>
      </div>

      <div class="detail-section">
        <h4 class="section-title">Configura√ß√µes</h4>
        <div class="details-grid">
          <div class="detail-item">
            <label>Comungante</label>
            <span class="badge" [class.active]="viewingMember.comungante" [class.inactive]="!viewingMember.comungante">
              {{ viewingMember.comungante ? 'Sim' : 'N√£o' }}
            </span>
          </div>
          <div class="detail-item">
            <label>Intercessor</label>
            <span class="badge" [class.active]="viewingMember.intercessor" [class.inactive]="!viewingMember.intercessor">
              {{ viewingMember.intercessor ? 'Sim' : 'N√£o' }}
            </span>
          </div>
          <div class="detail-item">
            <label>LGPD Aceito</label>
            <span class="badge" [class.active]="viewingMember.lgpd" [class.inactive]="!viewingMember.lgpd">
              {{ viewingMember.lgpd ? 'Sim' : 'N√£o' }}
            </span>
          </div>
          @if (viewingMember.lgpdAceitoEm) {
            <div class="detail-item">
              <label>LGPD Aceito Em</label>
              <span>{{ viewingMember.lgpdAceitoEm | date:'dd/MM/yyyy' }}</span>
            </div>
          }
        </div>
      </div>
    }
  </app-modal>
</div>
