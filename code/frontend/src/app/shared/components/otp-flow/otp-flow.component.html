@if (currentStep === 'phone') {
  <div class="search-section">
    <form [formGroup]="phoneForm" (ngSubmit)="onPhoneSubmit()">
      <div class="form-group">
        <label for="phone">Telefone *</label>
        <input
          id="phone"
          type="text"
          formControlName="phone"
          class="form-control"
          [class.is-invalid]="phoneForm.get('phone')?.invalid && phoneForm.get('phone')?.touched"
          placeholder="(00) 00000-0000"
          [mask]="'(00) 00000-0000'"
          [dropSpecialCharacters]="false"
          [disabled]="isLoading"
        />
        @if (phoneForm.get('phone')?.invalid && phoneForm.get('phone')?.touched) {
          <small class="error-text">
            @if (phoneForm.get('phone')?.hasError('required')) {
              Telefone é obrigatório
            } @else if (phoneForm.get('phone')?.hasError('minlength')) {
              Telefone deve ter pelo menos 10 dígitos
            }
          </small>
        }
      </div>

      <button
        type="submit"
        class="btn-primary"
        [disabled]="phoneForm.invalid || isLoading"
      >
        @if (isLoading) {
          Enviando...
        } @else {
          Enviar Código
        }
      </button>
    </form>
  </div>
}

@if (currentStep === 'code') {
  <div class="search-section">
    <div class="info-text">
      <p>Enviamos um código de verificação para o número:</p>
      <p class="phone-display">{{ formatPhone(phoneNumber) }}</p>
    </div>

    <form [formGroup]="codeForm" (ngSubmit)="onCodeSubmit()">
      <div class="form-group">
        <label for="code">Código de Verificação *</label>
        <input
          id="code"
          type="text"
          formControlName="code"
          class="form-control code-input"
          [class.is-invalid]="codeForm.get('code')?.invalid && codeForm.get('code')?.touched"
          placeholder="000000"
          [mask]="'000000'"
          maxlength="6"
          [disabled]="isLoading"
        />
        @if (codeForm.get('code')?.invalid && codeForm.get('code')?.touched) {
          <small class="error-text">
            @if (codeForm.get('code')?.hasError('required')) {
              Código é obrigatório
            } @else if (codeForm.get('code')?.hasError('pattern')) {
              Código deve ter 6 dígitos
            }
          </small>
        }
      </div>

      <div class="countdown-container">
        @if (countdown > 0) {
          <p class="countdown-text">Código expira em: {{ countdownFormatted }}</p>
        } @else {
          <p class="countdown-expired">Código expirado</p>
        }
      </div>

      <div class="actions">
        <button
          type="button"
          class="btn-link"
          (click)="backToPhone()"
          [disabled]="isLoading"
        >
          ← Alterar telefone
        </button>
        <button
          type="button"
          class="btn-link"
          (click)="resendCode()"
          [disabled]="isLoading || countdown > 0"
        >
          Reenviar código
        </button>
      </div>

      <button
        type="submit"
        class="btn-primary"
        [disabled]="codeForm.invalid || isLoading"
      >
        @if (isLoading) {
          Validando...
        } @else {
          Validar
        }
      </button>
    </form>
  </div>
}

